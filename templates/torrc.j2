{% macro renderbool(value) -%}
{{ '1' if value else '0' }}
{%- endmacro %}

{%- for port in torrc_socks_ports %}
SOCKSPort {{ port }}
{% endfor %}

{%- for policy in torrc_socks_policies %}
SOCKSPolicy {{ policy }}
{% endfor %}

{%- for log in torrc_logs %}
Log {{ log }}
{% endfor %}
{# Maybe not render if not needed? #}
RunAsDaemon {{ renderbool(torrc_run_as_daemon) }}

{%- if torrc_data_directory %}
DataDirectory {{ torrc_data_directory }}
{% endif %}

{%- if torrc_control_port %}
ControlPort {{ torrc_control_port }}
HashedControlPassword {{ torrc_hashed_control_password }}
CookieAuthentication {{ renderbool(torrc_cookie_authentication) }}
{% endif %}

{%- for service in torrc_hidden_services %}
HiddenServiceDir {{ service.dir }}
{%- for port in service.ports %}
HiddenServicePort {{ port }}
{% endfor %}
{% endfor %}

{%- for port in torrc_or_ports %}
ORPort {{ port }}
{% endfor %}
{#
## The IP address or full DNS name for incoming connections to your
## relay. Leave commented out and Tor will guess.
#Address noname.example.com
#}
{%- if torrc_address %}
Address {{ torrc_address }}
{% endif %}
{#
## If you have multiple network interfaces, you can specify one for
## outgoing traffic to use.
## OutboundBindAddressExit will be used for all exit traffic, while
## OutboundBindAddressOR will be used for all OR and Dir connections
## (DNS connections ignore OutboundBindAddress).
## If you do not wish to differentiate, use OutboundBindAddress to
## specify the same address for both in a single line.
#OutboundBindAddressExit 10.0.0.4
#OutboundBindAddressOR 10.0.0.5
#}
{%- if torrc_outbound_bind_address %}
OutboundBindAddress {{ torrc_outbound_bind_address }}
{% endif %}
{%- if torrc_outbound_bind_address_exit %}
OutboundBindAddressExit {{ torrc_outbound_bind_address_exit }}
{% endif %}
{%- if torrc_outbound_bind_address_or %}
OutboundBindAddressOR {{ torrc_outbound_bind_address_or }}
{% endif %}
{#
## A handle for your relay, so people don't have to refer to it by key.
## Nicknames must be between 1 and 19 characters inclusive, and must
## contain only the characters [a-zA-Z0-9].
## If not set, "Unnamed" will be used.
#Nickname ididnteditheconfig
#}
{%- if torrc_nickname %}
Nickname {{ torrc_nickname }}
{% endif %}
{#
## Define these to limit how much relayed traffic you will allow. Your
## own traffic is still unthrottled. Note that RelayBandwidthRate must
## be at least 75 kilobytes per second.
## Note that units for these config options are bytes (per second), not
## bits (per second), and that prefixes are binary prefixes, i.e. 2^10,
## 2^20, etc.
#RelayBandwidthRate 100 KBytes  # Throttle traffic to 100KB/s (800Kbps)
#RelayBandwidthBurst 200 KBytes # But allow bursts up to 200KB (1600Kb)
#}
{%- if torrc_relay_bandwidth_rate %}
RelayBandwidthRate {{ torrc_relay_bandwidth_rate }}
{% endif %}
{%- if torrc_relay_bandwidth_burst %}
RelayBandwidthBurst {{ torrc_relay_bandwidth_burst }}
{% endif %}
{#
## Use these to restrict the maximum traffic per day, week, or month.
## Note that this threshold applies separately to sent and received bytes,
## not to their sum: setting "40 GB" may allow up to 80 GB total before
## hibernating.
##
## Set a maximum of 40 gigabytes each way per period.
#AccountingMax 40 GBytes
## Each period starts daily at midnight (AccountingMax is per day)
#AccountingStart day 00:00
## Each period starts on the 3rd of the month at 15:00 (AccountingMax
## is per month)
#AccountingStart month 3 15:00
#}
{%- if torrc_accounting_max %}
AccountingMax {{ torrc_accounting_max }}
{% endif %}
{%- if torrc_accounting_start %}
AccountingStart {{ torrc_accounting_start }}
{% endif %}
{#
## Administrative contact information for this relay or bridge. This line
## can be used to contact you if your relay or bridge is misconfigured or
## something else goes wrong. Note that we archive and publish all
## descriptors containing these lines and that Google indexes them, so
## spammers might also collect them. You may want to obscure the fact that
## it's an email address and/or generate a new address for this purpose.
##
## If you are running multiple relays, you MUST set this option.
##
#ContactInfo Random Person <nobody AT example dot com>
## You might also include your PGP or GPG fingerprint if you have one:
#ContactInfo 0xFFFFFFFF Random Person <nobody AT example dot com>
#}
{%- if torrc_contact_info %}
ContactInfo {{ torrc_contact_info }}
{% endif %}
{#
## Uncomment this to mirror directory information for others. Please do
## if you have enough bandwidth.
#DirPort 9030 # what port to advertise for directory connections
## If you want to listen on a port other than the one advertised in
## DirPort (e.g. to advertise 80 but bind to 9091), you can do it as
## follows.  below too. You'll need to do ipchains or other port
## forwarding yourself to make this work.
#DirPort 80 NoListen
#DirPort 127.0.0.1:9091 NoAdvertise
#}
{%- for port in torrc_dir_ports %}
DirPort {{ port }}
{% endfor %}
{#
## Uncomment to return an arbitrary blob of html on your DirPort. Now you
## can explain what Tor is if anybody wonders why your IP address is
## contacting them. See contrib/tor-exit-notice.html in Tor's source
## distribution for a sample.
#DirPortFrontPage @CONFDIR@/tor-exit-notice.html
#}
{%- if torrc_dir_port_front_page %}
DirPortFrontPage {{ torrc_dir_port_front_page }}
{% endif %}
{#
## Uncomment this if you run more than one Tor relay, and add the identity
## key fingerprint of each Tor relay you control, even if they're on
## different networks. You declare it here so Tor clients can avoid
## using more than one of your relays in a single circuit. See
## https://www.torproject.org/docs/faq#MultipleRelays
## However, you should never include a bridge's fingerprint here, as it would
## break its concealability and potentially reveal its IP/TCP address.
##
## If you are running multiple relays, you MUST set this option.
##
## Note: do not use MyFamily on bridge relays.
#MyFamily $keyid,$keyid,...
#}
{%- if torrc_my_family %}
MyFamily {{ torrc_my_family }}
{% endif %}
{#
## Uncomment this if you want your relay to be an exit, with the default
## exit policy (or whatever exit policy you set below).
## (If ReducedExitPolicy, ExitPolicy, or IPv6Exit are set, relays are exits.
## If none of these options are set, relays are non-exits.)
#ExitRelay 1
#}
{%- if torrc_exit_relay %}
ExitRelay {{ renderbool(torrc_exit_relay) }}
{% endif %}
{#
## Uncomment this if you want your relay to allow IPv6 exit traffic.
## (Relays do not allow any exit traffic by default.)
#IPv6Exit 1
#}
{%- if torrc_ipv6_exit %}
IPv6Exit {{ renderbool(torrc_ipv6_exit) }}
{% endif %}
{#
## Uncomment this if you want your relay to be an exit, with a reduced set
## of exit ports.
#ReducedExitPolicy 1
#}
{%- if torrc_reduced_exit_policy %}
ReducedExitPolicy {{ renderbool(torrc_reduced_exit_policy) }}
{% endif %}
{#
## Uncomment these lines if you want your relay to be an exit, with the
## specified set of exit IPs and ports.
##
## A comma-separated list of exit policies. They're considered first
## to last, and the first match wins.
##
## If you want to allow the same ports on IPv4 and IPv6, write your rules
## using accept/reject *. If you want to allow different ports on IPv4 and
## IPv6, write your IPv6 rules using accept6/reject6 *6, and your IPv4 rules
## using accept/reject *4.
##
## If you want to _replace_ the default exit policy, end this with either a
## reject *:* or an accept *:*. Otherwise, you're _augmenting_ (prepending to)
## the default exit policy. Leave commented to just use the default, which is
## described in the man page or at
## https://www.torproject.org/documentation.html
##
## Look at https://www.torproject.org/faq-abuse.html#TypicalAbuses
## for issues you might encounter if you use the default exit policy.
##
## If certain IPs and ports are blocked externally, e.g. by your firewall,
## you should update your exit policy to reflect this -- otherwise Tor
## users will be told that those destinations are down.
##
## For security, by default Tor rejects connections to private (local)
## networks, including to the configured primary public IPv4 and IPv6 addresses,
## and any public IPv4 and IPv6 addresses on any interface on the relay.
## See the man page entry for ExitPolicyRejectPrivate if you want to allow
## "exit enclaving".
##
#ExitPolicy accept *:6660-6667,reject *:* # allow irc ports on IPv4 and IPv6 but no more
#ExitPolicy accept *:119 # accept nntp ports on IPv4 and IPv6 as well as default exit policy
#ExitPolicy accept *4:119 # accept nntp ports on IPv4 only as well as default exit policy
#ExitPolicy accept6 *6:119 # accept nntp ports on IPv6 only as well as default exit policy
#ExitPolicy reject *:* # no exits allowed
#}
{%- for policy in torrc_exit_policies %}
ExitPolicy {{ policy }}
{% endfor %}
{#
## Bridge relays (or "bridges") are Tor relays that aren't listed in the
## main directory. Since there is no complete public list of them, even an
## ISP that filters connections to all the known Tor relays probably
## won't be able to block all the bridges. Also, websites won't treat you
## differently because they won't know you're running Tor. If you can
## be a real relay, please do; but if not, be a bridge!
##
## Warning: when running your Tor as a bridge, make sure than MyFamily is
## NOT configured.
#BridgeRelay 1
## By default, Tor will advertise your bridge to users through various
## mechanisms like https://bridges.torproject.org/. If you want to run
## a private bridge, for example because you'll give out your bridge
## address manually to your friends, uncomment this line:
#PublishServerDescriptor 0
#}
{%- if torrc_bridge_relay %}
BridgeRelay {{ renderbool(torrc_bridge_relay) }}
PublishServerDescriptor {{ renderbool(torrc_publish_server_descriptor) }}
{% endif %}

{%- for include in torrc_includes %}
%include {{ include }}
{% endfor %}

{{ torrc_raw }}
